
<section class="home-container">
  <div class="d-flex gap-4">

    <div style="width: 300px">
      <form
        action="/"
        method="GET"
        class="d-flex flex-column gap-3"
        id="filterForm"
      >
        <input type="hidden" name="page" value="1" />

        <select class="form-select" name="categoryId">
          <option value="">Select Category</option>
          <% categories.forEach(c => { %>
          <option value="<%= c.id %>" <%=categoryId==c.id ? "selected" :""%>><%= c.category %></option>
          <% }) %>
        </select>

        <select class="form-select" name="price">
          <option value="">Select Price</option>
          <option value="asc" <%=price == "asc"? "selected":""%>>Low to High</option>
          <option value="desc" <%=price == "desc"? "selected":""%>>High to Low</option>
        </select>
      </form>
    </div>

  
    <div class="flex-grow-1 d-flex flex-wrap justify-content-center">
      <% if (products && products.length > 0) { %> <% products.forEach(p => { %>

      <div class="card m-2" style="width: 16rem; height: 350px">
        <img
          src="<%= p.image%>"
          class="card-img-top"
          style="height: 200px; object-fit: cover"
        />

        <div class="card-body d-flex flex-column justify-content-between">
          <div>
            <div class="d-flex justify-content-between mb-2">
              <h6 class="mb-0"><%= p.productName %></h6>
              <span class="fw-bold text-primary">$<%= p.price %></span>
            </div>

            <p style="height: 40px; overflow: hidden; font-size: 13px">
              <%= p.description.substring(0,45) %>...
            </p>
          </div>

          <div class="d-flex justify-content-between">
            <a href="/product/detail/<%= p.id %>" class="btn btn-primary btn-sm"
              >View</a
            >
          
            <button class="btn btn-success btn-sm" onclick="addToCart(<%=p.id%>)">
              <i class="bi bi-bag-plus"></i>
            </button>
          
          </div>
        </div>
      </div>

      <% }) %> <% } else { %>
      <p>No products found.</p>
      <% } %>
    </div>
  </div>
  
</section>
<% if (totalPages > 1) { %>
<nav class="mt-4 w-100 d-flex justify-content-center">
<ul class="pagination ">

  <% if (currentPage > 1) { %>
    <li class="page-item">
      <a
        class="page-link"
        href="/?page=<%= currentPage - 1 %>&limit=8&categoryId=<%= categoryId || "" %>&price=<%= price || "" %>&query=<%= query || "" %>"
      >
        Previous
      </a>
    </li>
  <% } %>

  <% for (let i = 1; i <= totalPages; i++) { %>
    <li class="page-item <%= currentPage === i ? 'active' : '' %>">
      <a
        class="page-link"
        href="/?page=<%= i %>&limit=8&categoryId=<%= categoryId || "" %>&price=<%= price || "" %>&query=<%= query || "" %>"
      >
        <%= i %>
      </a>
    </li>
  <% } %>

  <% if (currentPage < totalPages) { %>
    <li class="page-item">
      <a
        class="page-link"
        href="/?page=<%= currentPage + 1 %>&limit=8&categoryId=<%= categoryId || "" %>&price=<%= price || "" %>&query=<%= query || "" %>"
      >
        Next
      </a>
    </li>
  <% } %>

</ul>
</nav>
<% } %>

<script type="module" src="/js/home.js"></script>