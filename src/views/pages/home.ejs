<style>
  .home-container {
    min-height: 90vh;
    background-color: whitesmoke;
    padding: 40px;
    width: 100%;
  }
  .filters {
    width: 100%;
    margin-bottom: 20px;
    background-color: aqua;
  }
</style>

<section class="home-container">
  <div class="d-flex gap-4">

    <div style="width: 250px">
      <form
        action="/"
        method="GET"
        class="d-flex flex-column gap-3"
        id="filterForm"
      >
        <input type="hidden" name="page" value="1" />

        <select class="form-select" name="categoryId">
          <option value="">Select Category</option>
          <% categories.forEach(c => { %>
          <option value="<%= c.id %>" <%=categoryId==c.id ? "selected" :""%>><%= c.category %></option>
          <% }) %>
        </select>

        <select class="form-select" name="price">
          <option value="">Select Price</option>
          <option value="asc" <%=price == "asc"? "selected":""%>>Low to High</option>
          <option value="desc" <%=price == "desc"? "selected":""%>>High to Low</option>
        </select>
      </form>
    </div>

  
    <div class="flex-grow-1 d-flex flex-wrap justify-content-center">
      <% if (products && products.length > 0) { %> <% products.forEach(p => { %>

      <div class="card m-2" style="width: 16rem; height: 360px">
        <img
          src="<%= p.image%>"
          class="card-img-top"
          style="height: 200px; object-fit: cover"
        />

        <div class="card-body d-flex flex-column justify-content-between">
          <div>
            <div class="d-flex justify-content-between mb-2">
              <h6 class="mb-0"><%= p.productName %></h6>
              <span class="fw-bold text-primary">$<%= p.price %></span>
            </div>

            <p style="height: 45px; overflow: hidden; font-size: 13px">
              <%= p.description.substring(0,45) %>...
            </p>
          </div>

          <div class="d-flex justify-content-between">
            <a href="/product/detail/<%= p.id %>" class="btn btn-primary btn-sm"
              >View</a
            >
            <button class="btn btn-success btn-sm" onclick="addToCart(<%=p.id%>)">
              <i class="bi bi-bag-plus"></i>
            </button>
          </div>
        </div>
      </div>

      <% }) %> <% } else { %>
      <p>No products found.</p>
      <% } %>
    </div>
  </div>
</section>

<script>
  const filterForm = document.getElementById("filterForm");

  document.querySelectorAll("#filterForm select").forEach((select) => {
    select.addEventListener("change", () => {
      filterForm.submit();
    });
  });

</script>
<script>
  async function addToCart(productId) {
    const res = await fetch("/cart/addToCart", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ productId, quantity: 1 }),
    });

    const data = await res.json();
    alert(data.message);
  }
</script>